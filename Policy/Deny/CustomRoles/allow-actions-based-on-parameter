{
    "mode": "All",
    "policyRule": {
        "if": {
            "allOf": [
                {
                    "field": "type",
                    "equals": "Microsoft.Authorization/roleDefinitions"
                },
                {
                    "anyOf": [
                        {
                            "value": "[if(empty(field('Microsoft.Authorization/roleDefinitions/permissions[*].actions[*]')), bool('false'), equals(length(intersection(parameters('actions'), field('Microsoft.Authorization/roleDefinitions/permissions[*].actions[*]'))), length(parameters('actions'))))]",
                            "equals": false
                        },
                        {
                            "value": "[if(empty(field('Microsoft.Authorization/roleDefinitions/permissions[*].actions[*]')), bool('false'), equals(length(field('Microsoft.Authorization/roleDefinitions/permissions[*].actions[*]')),length(parameters('actions'))))]",
                            "equals": false
                        }
                    ]
                }
            ]
        },
        "then": {
            "effect": "[parameters('effect')]"
        }
    },
    "parameters": {
        "effect": {
            "type": "String",
            "metadata": {
                "displayName": "Effect",
                "description": "Deny policy or disable policy"
            },
            "defaultValue": "Deny"
        },
        "actions": {
            "type": "Array",
            "metadata": {
                "displayName": "Allowed Perms",
                "description": "Array of permissions to add to actions. When entering parameters in the portal add the permissions without the double quotes seperated by a comma. Also make sure there are not trailing or leading white spaces - Ex Microsoft.Authorization/elevateAccess/Action. Also case sensitive"
            }
        }
    }
}
